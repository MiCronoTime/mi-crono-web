<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Mi Crono ‚Äî modos</title>
  <link rel="stylesheet" href="styles.css"/>
  <style>
    :root{
      --bg:#121418; --panel:#1b1f27; --panel-2:#232a34; --text:#e8ecf1;
      --muted:#b5bdc9; --border:#2b3240; --accent:#5ea1ff; --accent-2:#7cc4ff;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background: radial-gradient(1200px 800px at 20% -10%, #151924 0%, transparent 60%),
                  radial-gradient(1200px 800px at 120% 10%, #1a2030 0%, transparent 55%),
                  var(--bg);
      color:var(--text);
    }
    a{color:var(--accent);text-decoration:none}
    a:hover{color:var(--accent-2)}
    .wrap{max-width:900px;margin:0 auto;padding:16px}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:18px;box-shadow:0 8px 30px rgba(0,0,0,.25)}
    h1{margin:14px 0 6px 0; font-size:22px; letter-spacing:.05em; text-transform:uppercase}
    p.muted{color:var(--muted);margin:0 0 12px 0}

    .modes{display:grid;grid-template-columns:1fr;gap:14px;margin-top:16px}
    @media (min-width:700px){ .modes{grid-template-columns:1fr 1fr} }

    .btn{
      display:flex;align-items:center;gap:10px;justify-content:center;
      padding:16px;border-radius:14px;border:1px solid var(--border);
      background:#0f1217;color:var(--text);text-decoration:none;font-weight:900;letter-spacing:.04em;
      text-transform:uppercase; min-height:64px; transition:transform .05s, background .15s, border-color .15s;
    }
    .btn:hover{background:#12161d}
    .btn.primary{background:var(--accent);color:#0b1220;border-color:var(--accent)}
    .btn.primary:hover{background:var(--accent-2);border-color:var(--accent-2)}
    .emoji{font-size:20px}
    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    input[type=text], input[type=email], input[type=password]{
      padding:8px 10px;border-radius:10px;border:1px solid var(--border);background:#1b1f27;color:#e8ecf1;
    }
  </style>
</head>
<body>

  <!-- ========= FRANJA LOGIN / REGISTRO (a√±adido) ========= -->
  <div id="authBar" style="background:#0f1217;border-bottom:1px solid #2b3240;color:#e8ecf1;font:600 14px/1.1 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; padding:10px 14px; display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
    <span style="font-weight:800;letter-spacing:.03em;">CUENTA</span>

    <!-- Conectado -->
    <div id="authSigned" style="display:none; align-items:center; gap:10px;">
      <span>Conectado: <b id="authUserLabel">‚Äî</b></span>
      <button id="btnLogout" style="padding:8px 12px;border-radius:10px;border:1px solid #2b3240;background:#1b1f27;color:#e8ecf1;cursor:pointer;">Salir</button>
    </div>

    <!-- Form login/registro -->
    <form id="authForm" style="display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin:0;">
      <input id="authEmail" type="email" placeholder="Email" required style="min-width:220px;">
      <input id="authPass" type="password" placeholder="Contrase√±a" required style="min-width:160px;">
      <button id="btnLogin"  type="submit" class="btn" style="padding:8px 12px; min-height:auto;">Entrar</button>
      <button id="btnSignup" type="button" class="btn" style="padding:8px 12px; min-height:auto;">Crear cuenta</button>
    </form>

    <span id="authMsg" style="color:#b5bdc9;"></span>
  </div>
  <!-- ====================================================== -->

  <div class="wrap" style="margin-top:14px">
    <div class="card">
      <h1>Selecciona modo</h1>
      <p class="muted">Elige c√≥mo quieres cronometrar:</p>

      <div class="modes">
        <a class="btn primary" href="singletrack_index.html">
          <span class="emoji">üèÅ</span> SINGLETRACK
        </a>
        <a class="btn" href="cronolap_index.html">
          <span class="emoji">‚è±Ô∏è</span> CRONOLAP
        </a>
      </div>
    </div>
  </div>

  <!-- ============== Firebase + Auth (m√≥dulos CDN) ============== -->
  <script type="module">
    import { initializeApp, getApps, getApp } from 'https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js';
    import {
      getAuth, onAuthStateChanged, signInWithEmailAndPassword,
      createUserWithEmailAndPassword, signOut, setPersistence, browserLocalPersistence
    } from 'https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js';

    // (Si aqu√≠ necesitas usar Firestore, puedes importarlo tambi√©n.)
    // import { getFirestore } from 'https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyCt52Q6LEJ0fl0iKUIE6OKXlbp42fzOgBU",
      authDomain: "mi-crono-time-888b7.firebaseapp.com",
      projectId: "mi-crono-time-888b7",
      storageBucket: "mi-crono-time-888b7.appspot.com",
      messagingSenderId: "379025900327",
      appId: "1:379025900327:web:6f10f46ee086ca61f8df02"
    };

    const app  = getApps().length ? getApp() : initializeApp(firebaseConfig);
    const auth = getAuth();
    await setPersistence(auth, browserLocalPersistence);

    const $ = (id)=>document.getElementById(id);
    const authForm   = $('authForm');
    const authSigned = $('authSigned');
    const authMsg    = $('authMsg');
    const authEmail  = $('authEmail');
    const authPass   = $('authPass');
    const authUserLabel = $('authUserLabel');
    const btnLogin   = $('btnLogin');
    const btnSignup  = $('btnSignup');
    const btnLogout  = $('btnLogout');

    // Estado global para que otras p√°ginas puedan leer si hace falta
    window.currentUserUid  = null;
    window.currentUserName = null;

    onAuthStateChanged(auth, (user)=>{
      if(user){
        window.currentUserUid  = user.uid;
        window.currentUserName = user.email || 'usuario';
        authUserLabel.textContent = (window.currentUserName||'').toUpperCase();
        authForm.style.display   = 'none';
        authSigned.style.display = 'flex';
        authMsg.textContent = '';
      }else{
        window.currentUserUid  = null;
        window.currentUserName = null;
        authForm.style.display   = 'flex';
        authSigned.style.display = 'none';
      }
    });

    // Entrar
    authForm.addEventListener('submit', async (e)=>{
      e.preventDefault();
      authMsg.textContent = 'Entrando‚Ä¶';
      try{
        await signInWithEmailAndPassword(auth, authEmail.value.trim(), authPass.value);
        authMsg.textContent = '';
      }catch(err){
        authMsg.textContent = 'Error al entrar: ' + (err?.message||err);
      }
    });

    // Crear cuenta
    btnSignup.addEventListener('click', async ()=>{
      authMsg.textContent = 'Creando cuenta‚Ä¶';
      try{
        await createUserWithEmailAndPassword(auth, authEmail.value.trim(), authPass.value);
        authMsg.textContent = '';
      }catch(err){
        authMsg.textContent = 'Error al registrar: ' + (err?.message||err);
      }
    });

    // Salir
    btnLogout.addEventListener('click', async ()=>{
      try{ await signOut(auth); }catch(e){}
    });
  </script>
</body>
</html>
