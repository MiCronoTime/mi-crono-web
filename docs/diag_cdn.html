<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Diag Firebase (CDN)</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#0f141c;color:#eaf0f8;margin:0;padding:20px}
    .ok{color:#7cffb6;font-weight:800}
    .err{color:#ff7a8a;font-weight:800}
    .muted{opacity:.85}
    .card{background:#161c24;border:1px solid #2a3342;border-radius:14px;padding:16px;max-width:700px}
    code{background:#0c1117;border:1px solid #2a3342;border-radius:6px;padding:2px 6px}
  </style>
</head>
<body>
  <h1>Diagnóstico Firebase (CDN)</h1>
  <div class="card">
    <div>Estado: <span id="state" class="muted">Cargando…</span></div>
    <div id="line"></div>
    <pre id="out" class="muted"></pre>
  </div>

  <script type="module">
    const S = (t,c)=>{ const el=document.getElementById('state'); el.textContent=t; el.className=c||''; };
    const L = (t)=>{ document.getElementById('line').innerHTML = t; };
    const O = (t)=>{ const el=document.getElementById('out'); el.textContent += t + "\n"; };

    try{
      // ⬇️ ESTA es la “línea de código” clave (import por CDN, módulos ES)
      L('<code>https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js</code> y <code>firebase-firestore.js</code>');

      const { initializeApp, getApp, getApps } =
        await import('https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js');
      const {
        getFirestore, doc, setDoc, getDoc, serverTimestamp, collection, addDoc
      } = await import('https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js');

      const firebaseConfig = {
        apiKey: "AIzaSyCt52Q6LEJ0fl0iKUIE6OKXlbp42fzOgBU",
        authDomain: "mi-crono-time-888b7.firebaseapp.com",
        projectId: "mi-crono-time-888b7",
        storageBucket: "mi-crono-time-888b7.appspot.com",
        messagingSenderId: "379025900327",
        appId: "1:379025900327:web:6f10f46ee086ca61f8df02"
      };

      const app = getApps().length ? getApp() : initializeApp(firebaseConfig);
      const db  = getFirestore(app);

      S('Módulos ES cargados, inicializando…');

      // Pequeña prueba de escritura/lectura
      const pingCol = collection(db, '_diag_ping');
      const ref = await addDoc(pingCol, { serverNow: serverTimestamp() });
      const snap = await getDoc(ref);

      if (snap.exists()) {
        S('Firebase OK (app + Firestore)', 'ok');
        O('App name: ' + app.name);
        O('ProjectId: ' + app.options.projectId);
        O('Doc ID: ' + ref.id);
        O('serverNow: ' + JSON.stringify(snap.data().serverNow));
      } else {
        S('Firebase ERROR (no se pudo leer doc)', 'err');
      }
    } catch (e) {
      S('Firebase ERROR', 'err');
      O((e && (e.stack || e.message)) || String(e));
    }
  </script>
</body>
</html>
